<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Game of Ur - In√≠cio</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <header>
        <div class="user-actions">
            <% if (user) { %>
                <div class="logged-in-menu">
                    <a href="/profile" class="user-link">
                        <span class="user-avatar-small">üë§</span> 
                        Ol√°, <strong><%= user.username %></strong>
                    </a>
                    <a href="/auth/logout" class="btn-logout-small">Sair</a>
                </div>
            <% } else { %>
                <a href="/login" class="btn-login-header">Entrar / Cadastrar</a>
            <% } %>
        </div>

        <h1>The Royal Game of Ur</h1>
        
        <nav>
            <ul>
                <li><a href="#game-selection">Jogar</a></li>
                <li><a href="#sobre">Sobre</a></li>
                <li><a href="/rules">Regras</a></li>
                <li><a href="#disciplina">Disciplina</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="layout-grid">
            
            <main class="white-card main-content">
                <section id="game-selection" class="hero-section">
                    <h2>Pronto para o desafio milenar?</h2>
                    <p>Escolha seu modo de jogo:</p>
                    
                    <div class="menu-buttons">

                        <% if (user && user.isAdmin) { %>
                            <a href="/admin" class="btn-primary" style="background-color: #e74c3c;">
                                Painel Admin
                            </a>
                        <% } %>

                        <a href="/game?mode=bot" class="btn-primary" style="background-color: #f39c12;">
                            Play vs Bot
                        </a>
                        <% if (user) { %>
                            <button id="btn-create-room" class="btn-primary">Criar Sala</button>
                        <% } else { %>
                            <a href="/login?action=create" class="btn-primary">Fa√ßa login p/ Criar Sala</a>
                        <% } %>
                    </div>
                </section>

                <hr class="divider">

                <section id="sobre">
                    <h3>Sobre o Projeto</h3>
                    <!-- <p>O Jogo Real de Ur √© um dos jogos de tabuleiro mais antigos j√° descobertos, origin√°rio da antiga Mesopot√¢mia. Este projeto visa recriar a experi√™ncia online com suporte a multiplayer e bots.</p> -->
                    <p>
                        O <strong>Jogo Real de Ur</strong> √© um dos jogos de tabuleiro mais antigos da hist√≥ria, datado de aproximadamente 2600 a.C. 
                        Tabuleiros deste jogo foram encontrados pelo arque√≥logo Sir Leonard Woolley nas Tumbas Reais de Ur, no atual Iraque, durante a d√©cada de 1920.
                    </p>
                    <p>
                        Por mil√™nios, as regras foram esquecidas. Foi somente no in√≠cio dos anos 80 que o curador do Museu Brit√¢nico, 
                        <strong>Dr. Irving Finkel</strong>, decifrou uma tabuleta cuneiforme antiga que descrevia como o jogo era jogado. 
                        Este projeto √© uma recria√ß√£o digital baseada nessa tradu√ß√£o hist√≥rica.
                    </p>
                </section>

                <!-- <section id="regras">
                    <h3>Regras B√°sicas</h3>
                     <div class="rules-container">
                        <p>O objetivo √© ser o primeiro a levar todas as suas <strong>7 pe√ßas</strong> do in√≠cio ao fim do tabuleiro.</p>
                        
                        <h3>1. Os Dados</h3>
                        <p>
                            O jogo utiliza 4 dados tetra√©dricos. Cada dado tem 2 pontas marcadas e 2 vazias.
                            A soma das pontas marcadas define quantas casas voc√™ anda (de 0 a 4).
                        </p>
                        
                        <h3>2. O Tabuleiro e o Caminho</h3>
                        <p>
                            Existem tr√™s zonas no tabuleiro:
                        </p>
                        <ul>
                            <li><strong>Zona Segura (In√≠cio):</strong> Os primeiros 4 quadrados do seu lado.</li>
                            <li><strong>Zona de Guerra (Meio):</strong> A linha central de 8 quadrados. Aqui voc√™ pode capturar e ser capturado.</li>
                            <li><strong>Zona Segura (Fim):</strong> Os √∫ltimos 2 quadrados do seu lado antes da sa√≠da.</li>
                        </ul>

                        <h3>3. Movimento e Captura</h3>
                        <ul>
                            <li>Voc√™ precisa tirar um n√∫mero exato para colocar uma pe√ßa no tabuleiro.</li>
                            <li>Se voc√™ cair em uma casa ocupada por uma pe√ßa inimiga (na Zona de Guerra), a pe√ßa inimiga √© <strong>capturada</strong> e volta para o in√≠cio.</li>
                            <li>Voc√™ nunca pode andar para uma casa que j√° tenha uma pe√ßa sua.</li>
                        </ul>

                        <h3>4. A Roseta (üå∏)</h3>
                        <p>As casas marcadas com uma flor (Roseta) s√£o especiais:</p>
                        <ul>
                            <li><strong>Turno Extra:</strong> Se cair nela, voc√™ joga os dados novamente.</li>
                            <li><strong>Imunidade:</strong> A pe√ßa na Roseta central <strong>n√£o pode ser capturada</strong>.</li>
                        </ul>
                        
                        <h3>5. Vencendo</h3>
                        <p>Para tirar uma pe√ßa do tabuleiro, voc√™ precisa de um lan√ßamento de dados exato para "sair" (como se fosse a casa 15). O primeiro a retirar as 7 pe√ßas vence.</p>
                    </div>
                </section> -->

                <section id="disciplina">
                    <h3>Disciplina</h3>
                     <p>
                        Este sistema foi desenvolvido como requisito avaliativo para a disciplina 
                        <strong>INE5646 - Programa√ß√£o para Web</strong> da Universidade Federal de Santa Catarina (UFSC).
                    </p>
                    <p>
                        <strong>Integrantes:</strong> Ruan Luiz Molgero Lopes.<br>
                        <strong>Tecnologias:</strong> Node.js, Express, Socket.io, MongoDB e WebRTC.
                    </p>
                </section>
            </main>

            <aside class="white-card sidebar-content">
                <div class="panel-header">
                    <h3>üî¥ Salas ao Vivo</h3>
                    <small>Tempo real</small>
                </div>
                
                <div id="live-list" class="room-cards-container">
                    <p style="text-align:center; color:#888; padding:20px;">Carregando...</p>
                </div>
            </aside>

            <aside class="white-card sidebar-content">
                <div class="panel-header" style="background-color: #f1c40f; color: #333;">
                    <h3>üèÜ Top 5</h3>
                    <small>Ranked (PvP)</small> 
                </div>
                
                <div class="ranking-list">
                    <% if (ranking.length > 0) { %>
                        <% ranking.forEach((player, index) => { %>
                            <div class="ranking-item">
                                <div class="rank-pos rank-<%= index + 1 %>"><%= index + 1 %></div>
                                <img src="<%= player.avatar || 'https://api.dicebear.com/9.x/bottts/svg?seed=default' %>" class="rank-avatar-img" alt="Avatar">
                                <div class="rank-name"><%= player.username %></div>
                                <div class="rank-score"><%= player.matchesWon %></div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p style="text-align:center; padding:15px; color:#999; font-size:0.9rem;">Sem dados ainda.</p>
                    <% } %>
                </div>
            </aside>

        </div>
    </div>

    <footer>
        <p>UFSC - Sistemas de Informa√ß√£o - 2025</p>
    </footer>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const currentUser = "<%= user ? user.username : '' %>";

        const socket = io({
            query: {
                username: currentUser
            }
        });

        const liveList = document.getElementById('live-list');
        const userLoggedIn = "<%= user ? 'true' : 'false' %>" === 'true';

        const btnCreate = document.getElementById('btn-create-room');

        function triggerCreateRoom() {
            const name = prompt("Nome da sala:");
            if(name && name.trim() !== "") {
                socket.emit('create-room', name);
            }
        }

        if(btnCreate) {
            btnCreate.addEventListener('click', () => {
                const name = prompt("Nome da sala:");
                if(name) socket.emit('create-room', name);
            });
        }
        socket.on('room-created', (id) => window.location.href = `/game?room=${id}`);

        socket.emit('request-lobby');
        socket.on('lobby-list', (rooms) => {
            liveList.innerHTML = '';
            if (rooms.length === 0) {
                liveList.innerHTML = '<div class="empty-state">Nenhuma sala ativa.</div>';
                return;
            }
            rooms.forEach(room => {
                const statusText = room.status === 'playing' ? 'Em Jogo' : 'Aguardando';
                const statusClass = room.status === 'playing' ? 'status-busy' : 'status-open';
                let actionBtn = '';
                if (room.status === 'waiting') {
                    if (userLoggedIn) actionBtn = `<a href="/game?room=${room.id}" class="btn-room-action btn-join">Desafiar</a>`;
                    else actionBtn = `<a href="/login" class="btn-room-action btn-login-mini">Logar</a>`;
                }
                const watchBtn = `<a href="/game?room=${room.id}" class="btn-room-action btn-watch">Ver</a>`;

                const card = document.createElement('div');
                card.className = 'room-item';
                card.innerHTML = `
                    <div style="flex:1">
                        <strong>${room.name}</strong>
                        <div class="room-meta"><span class="status-dot ${statusClass}"></span> ${statusText}</div>
                    </div>
                    <div style="display:flex; gap:5px; align-items:center;">${watchBtn}${actionBtn}</div>
                `;
                liveList.appendChild(card);
            });
        });
    </script>
</body>
</html>