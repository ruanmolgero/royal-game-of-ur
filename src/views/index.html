<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Game of Ur - In√≠cio</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <header>
        <div class="user-actions">
            <% if (user) { %>
                <div class="logged-in-menu">
                    <a href="/profile" class="user-link">
                        <span class="user-avatar-small">üë§</span> 
                        Ol√°, <strong><%= user.username %></strong>
                    </a>
                    <a href="/auth/logout" class="btn-logout-small">Sair</a>
                </div>
            <% } else { %>
                <a href="/login" class="btn-login-header">Entrar / Cadastrar</a>
            <% } %>
        </div>

        <h1>The Royal Game of Ur</h1>
        
        <nav>
            <ul>
                <li><a href="#game-selection">Jogar</a></li>
                <li><a href="#sobre">Sobre</a></li>
                <li><a href="#regras">Regras</a></li>
                <li><a href="#disciplina">Disciplina</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="layout-grid">
            
            <main class="white-card main-content">
                
                <section id="game-selection" class="hero-section">
                    <h2>Pronto para o desafio milenar?</h2>
                    <p>Escolha seu modo de jogo:</p>
                    
                    <div class="menu-buttons">
                        <a href="/game?mode=bot" class="btn-primary" style="background-color: #f39c12;">
                            Play vs Bot
                        </a>
                        <% if (user) { %>
                            <button id="btn-create-room" class="btn-primary">Criar Sala</button>
                        <% } else { %>
                            <a href="/login" class="btn-primary">Fa√ßa login p/ Criar Sala</a>
                        <% } %>
                    </div>
                </section>

                <hr class="divider">

                <section id="sobre">
                    <h3>Sobre o Projeto</h3>
                    <p>O Jogo Real de Ur √© um dos jogos de tabuleiro mais antigos j√° descobertos, origin√°rio da antiga Mesopot√¢mia. Este projeto visa recriar a experi√™ncia online com suporte a multiplayer e bots.</p>
                </section>

                <section id="regras">
                    <h3>Regras B√°sicas</h3>
                    <p>O objetivo √© percorrer o tabuleiro com suas 7 pe√ßas antes do advers√°rio. Utilize os dados tetra√©dricos para mover. Cair na casa da Roseta concede um turno extra!</p>
                </section>

                <section id="disciplina">
                    <h3>Disciplina</h3>
                    <p>Desenvolvido para <strong>INE5646 - Programa√ß√£o para Web</strong> (UFSC).</p>
                </section>
            </main>

            <aside class="white-card sidebar-content">
                <div class="panel-header">
                    <h3>üî¥ Salas ao Vivo</h3>
                    <small>Tempo real</small>
                </div>
                
                <div id="live-list" class="room-cards-container">
                    <p style="text-align:center; color:#888; padding:20px;">Carregando...</p>
                </div>
            </aside>

        </div>
    </div>

    <footer>
        <p>UFSC - Sistemas de Informa√ß√£o - 2025</p>
    </footer>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const liveList = document.getElementById('live-list');
        const userLoggedIn = "<%= user ? 'true' : 'false' %>" === 'true';

        const btnCreate = document.getElementById('btn-create-room');
        if(btnCreate) {
            btnCreate.addEventListener('click', () => {
                const name = prompt("Nome da sala:");
                if(name) socket.emit('create-room', name);
            });
        }
        socket.on('room-created', (id) => window.location.href = `/game?room=${id}`);

        socket.emit('request-lobby');
        socket.on('lobby-list', (rooms) => {
            liveList.innerHTML = '';
            if (rooms.length === 0) {
                liveList.innerHTML = '<div class="empty-state">Nenhuma sala ativa.</div>';
                return;
            }
            rooms.forEach(room => {
                const statusText = room.status === 'playing' ? 'Em Jogo' : 'Aguardando';
                const statusClass = room.status === 'playing' ? 'status-busy' : 'status-open';
                let actionBtn = '';
                if (room.status === 'waiting') {
                    if (userLoggedIn) actionBtn = `<a href="/game?room=${room.id}" class="btn-room-action btn-join">Desafiar</a>`;
                    else actionBtn = `<a href="/login" class="btn-room-action btn-login-mini">Logar</a>`;
                }
                const watchBtn = `<a href="/game?room=${room.id}" class="btn-room-action btn-watch">Ver</a>`;

                const card = document.createElement('div');
                card.className = 'room-item';
                card.innerHTML = `
                    <div style="flex:1">
                        <strong>${room.name}</strong>
                        <div class="room-meta"><span class="status-dot ${statusClass}"></span> ${statusText}</div>
                    </div>
                    <div style="display:flex; gap:5px; align-items:center;">${watchBtn}${actionBtn}</div>
                `;
                liveList.appendChild(card);
            });
        });
    </script>
</body>
</html>